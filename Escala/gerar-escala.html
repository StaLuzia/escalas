<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gerar Escala</title>
<style>
  body { font-family: Arial, sans-serif; background:#f8f9fa; padding:20px; display:flex; justify-content:center; }
  .container { background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); width:400px; }
  input { width:90%; padding:10px; margin:10px 0; border-radius:4px; border:1px solid #ccc; }
  button { width:97%; padding:10px; margin:10px 0; border-radius:4px; background:#28a745; color:#fff; border:none; cursor:pointer; }
  button:hover { background:#218838; }
  ul { list-style-type: disc; margin-left: 20px; }
</style>
</head>
<body>
<div class="container">
  <h2>Gerar Escala</h2>
  <label for="mes">Selecione o mês:</label>
  <input type="month" id="mes" />
  <button id="gerarBtn">Gerar Escala</button>
  <div id="resultado" style="margin-top:20px;"></div>
</div>

<script>
  document.getElementById('gerarBtn').addEventListener('click', () => {
    const mes = document.getElementById('mes').value;
    if(!mes) {
      alert('Selecione um mês!');
      return;
    }

    const participantes = JSON.parse(localStorage.getItem('participantes') || '[]');
    const missas = JSON.parse(localStorage.getItem('missas') || '[]');

    if(participantes.length === 0 || missas.length === 0) {
      alert('Cadastre participantes e missas antes de gerar a escala!');
      return;
    }

    // Simples geração: apenas lista missas com 1 participante de cada função (se disponível)
    const escala = missas.map(missa => {
      const data = missa.data;
      const horario = missa.horario;
      const comunidade = missa.comunidade;

      // Filtrar participantes que dizem estar disponíveis para esse dia e hora
      const participantesDisponiveis = participantes.filter(p => {
        return p.disponibilidade.toLowerCase().includes(diaSemanaNome(new Date(data))?.toLowerCase()) &&
               p.disponibilidade.includes(horario.slice(0,2)); // verifica só hora (ex: 18)
      });

      // Para cada função, pega 1 participante disponível (se houver)
      const coroinha = participantesDisponiveis.find(p => p.funcao === 'coroinha');
      const acolito = participantesDisponiveis.find(p => p.funcao === 'acolito');
      const cerimon = participantesDisponiveis.find(p => p.funcao === 'cerimoniario');

      return `${data} ${horario} - Comunidade: ${comunidade} | Coroinha: ${coroinha ? coroinha.nome : '-'} | Acólito: ${acolito ? acolito.nome : '-'} | Cerimoniário: ${cerimon ? cerimon.nome : '-'}`;
    });

    const resultadoDiv = document.getElementById('resultado');
    resultadoDiv.innerHTML = `<h3>Escala para ${mes}</h3><ul>${escala.map(l => `<li>${l}</li>`).join('')}</ul>`;
  });

  function diaSemanaNome(data) {
    const dias = ['domingo', 'segunda', 'terça', 'quarta', 'quinta', 'sexta', 'sábado'];
    return dias[data.getDay()];
  }
</script>
</body>
</html>
